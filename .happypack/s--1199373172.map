{"version":3,"sources":["server/middleware/reactApplication/ServerHTML.js"],"names":["KeyedComponent","children","only","clientEntryAssets","stylesheetTag","stylesheetFilePath","scriptTag","jsFilePath","ServerHTML","props","asyncComponentsState","helmet","nonce","reactAppString","inlineScript","body","__html","headerElements","meta","toComponent","title","base","link","css","style","bodyElements","join","process","env","BUILD_FLAG_IS_DEV","Date","now","js","script","htmlAttributes","map","x","idx","propTypes","object","string"],"mappings":"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","file":"ServerHTML.js","sourceRoot":"/home/spineor/Documents/risorso /newSetup_frontend/react-universally","sourcesContent":["/**\n * This module is responsible for generating the HTML page response for\n * the react application middleware.\n */\n\n/* eslint-disable react/no-danger */\n/* eslint-disable react/no-array-index-key */\n\nimport React, { Children } from 'react';\nimport PropTypes from 'prop-types';\nimport serialize from 'serialize-javascript';\n\nimport config from '../../../config';\nimport ifElse from '../../../shared/utils/logic/ifElse';\nimport removeNil from '../../../shared/utils/arrays/removeNil';\nimport getClientBundleEntryAssets from './getClientBundleEntryAssets';\n\nimport ClientConfig from '../../../config/components/ClientConfig';\nimport HTML from '../../../shared/components/HTML';\n\n// PRIVATES\n\nfunction KeyedComponent({ children }) {\n  return Children.only(children);\n}\n\n// Resolve the assets (js/css) for the client bundle's entry chunk.\nconst clientEntryAssets = getClientBundleEntryAssets();\n\nfunction stylesheetTag(stylesheetFilePath) {\n  return (\n    <link href={stylesheetFilePath} media=\"screen, projection\" rel=\"stylesheet\" type=\"text/css\" />\n  );\n}\n\nfunction scriptTag(jsFilePath) {\n  return <script type=\"text/javascript\" src={jsFilePath} />;\n}\n\n// COMPONENT\n\nfunction ServerHTML(props) {\n  const { asyncComponentsState, helmet, nonce, reactAppString } = props;\n\n  // Creates an inline script definition that is protected by the nonce.\n  const inlineScript = body =>\n    <script nonce={nonce} type=\"text/javascript\" dangerouslySetInnerHTML={{ __html: body }} />;\n\n  const headerElements = removeNil([\n    ...ifElse(helmet)(() => helmet.meta.toComponent(), []),\n    ...ifElse(helmet)(() => helmet.title.toComponent(), []),\n    ...ifElse(helmet)(() => helmet.base.toComponent(), []),\n    ...ifElse(helmet)(() => helmet.link.toComponent(), []),\n    ifElse(clientEntryAssets && clientEntryAssets.css)(() => stylesheetTag(clientEntryAssets.css)),\n    ...ifElse(helmet)(() => helmet.style.toComponent(), []),\n  ]);\n\n  const bodyElements = removeNil([\n    // Binds the client configuration object to the window object so\n    // that we can safely expose some configuration values to the\n    // client bundle that gets executed in the browser.\n    <ClientConfig nonce={nonce} />,\n    // Bind our async components state so the client knows which ones\n    // to initialise so that the checksum matches the server response.\n    // @see https://github.com/ctrlplusb/react-async-component\n    ifElse(asyncComponentsState)(() =>\n      inlineScript(\n        `window.__ASYNC_COMPONENTS_REHYDRATE_STATE__=${serialize(asyncComponentsState)};`,\n      ),\n    ),\n    // Enable the polyfill io script?\n    // This can't be configured within a react-helmet component as we\n    // may need the polyfill's before our client JS gets parsed.\n    ifElse(config('polyfillIO.enabled'))(() =>\n      scriptTag(`${config('polyfillIO.url')}?features=${config('polyfillIO.features').join(',')}`),\n    ),\n    // When we are in development mode our development server will\n    // generate a vendor DLL in order to dramatically reduce our\n    // compilation times.  Therefore we need to inject the path to the\n    // vendor dll bundle below.\n    ifElse(\n      process.env.BUILD_FLAG_IS_DEV === 'true' && config('bundles.client.devVendorDLL.enabled'),\n    )(() =>\n      scriptTag(\n        `${config('bundles.client.webPath')}${config(\n          'bundles.client.devVendorDLL.name',\n        )}.js?t=${Date.now()}`,\n      ),\n    ),\n    ifElse(clientEntryAssets && clientEntryAssets.js)(() => scriptTag(clientEntryAssets.js)),\n    ...ifElse(helmet)(() => helmet.script.toComponent(), []),\n  ]);\n\n  return (\n    <HTML\n      htmlAttributes={ifElse(helmet)(() => helmet.htmlAttributes.toComponent(), null)}\n      headerElements={headerElements.map((x, idx) =>\n        (<KeyedComponent key={idx}>\n          {x}\n        </KeyedComponent>),\n      )}\n      bodyElements={bodyElements.map((x, idx) =>\n        (<KeyedComponent key={idx}>\n          {x}\n        </KeyedComponent>),\n      )}\n      appBodyString={reactAppString}\n    />\n  );\n}\n\nServerHTML.propTypes = {\n  // eslint-disable-next-line react/forbid-prop-types\n  asyncComponentsState: PropTypes.object,\n  // eslint-disable-next-line react/forbid-prop-types\n  helmet: PropTypes.object,\n  nonce: PropTypes.string,\n  reactAppString: PropTypes.string,\n};\n\n// EXPORT\n\nexport default ServerHTML;\n"]}